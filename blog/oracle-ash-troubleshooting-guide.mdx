---
title: "Oracle Active Session History (ASH) ile Gelişmiş Sorun Giderme"
description: "Veritabanındaki anlık ve geçmiş performans sorunlarını SQL ID, wait event ve session bazlı analiz etmek için ASH ve AWR sorgu teknikleri."
date: 2026-01-16
category: "Oracle Performans"
tags: ["oracle", "ash", "awr", "wait events", "active session history", "dba", "troubleshooting"]
author: "Oracle DBA Blog"
---

# Oracle Active Session History (ASH) ile Gelişmiş Sorun Giderme

Oracle **Active Session History (ASH)**, veritabanındaki aktif oturumların saniyede bir örneklemini (sampling) alan müthiş bir performans analiz aracıdır. Diğer araçların aksine, sistemin o anki "röntgenini" çekmenizi sağlar ve geçmişteki belirli bir zaman diliminde (örneğin dün sabah 10:00 - 10:15 arası) ne olduğunu anlamanıza yardımcı olur.


<!--truncate-->
## ASH Neden Önemlidir?

- **Proaktif Analiz:** Sorun anında veritabanına bağlanıp ne olduğunu saniyeler içinde görebilirsiniz.
- **Historik Data:** AWR verileri gibi saatlik değil, saniyelik detaylar sunar (geçmiş veriler `DBA_HIST_ACTIVE_SESS_HISTORY` tablosunda saklanır).
- **SQL Bazlı Takip:** Belirli bir SQL_ID'nin hangi event'lerde beklediğini ve ne kadar kaynak tükettiğini net bir şekilde gösterir.

## Kritik ASH Sorguları

Aşağıdaki sorgularla performans sorunlarını kök nedenine kadar takip edebilirsiniz.

### 1. Belirli Bir Zaman Aralığında SQL_ID Dağılımı

Hangi sorgunun o an sistemi meşgul ettiğini bulmak için:

```sql
SELECT sql_id, 
       COUNT(*) AS samples,
       ROUND(COUNT(*) / SUM(COUNT(*)) OVER() * 100, 2) AS pct_load
FROM gv$active_session_history
WHERE sample_time BETWEEN TO_DATE('16-01-2026 09:00', 'DD-MM-YYYY HH24:MI') 
                      AND TO_DATE('16-01-2026 09:30', 'DD-MM-YYYY HH24:MI')
GROUP BY sql_id
ORDER BY samples DESC;
```

### 2. Belirli Bir SQL_ID İçin Wait Event Analizi

Bir sorgunun neden yavaş çalıştığını (Network mü, Disk mi, Lock mı?) anlamak için:

```sql
SELECT event, 
       COUNT(*) AS samples
FROM gv$active_session_history
WHERE sql_id = '4nyaubpsh8kd2'
  AND sample_time > SYSDATE - 1/24 -- Son 1 saat
GROUP BY event
ORDER BY samples DESC;
```

### 3. Kaynak Bekleyen Session'lar (Event ID Bazlı)

Belirli bir bekleme tipine (örneğin DB File Sequential Read) göre hangi SQL'lerin takıldığını bulmak için:

```sql
SELECT sql_id, 
       COUNT(*) AS samples
FROM dba_hist_active_sess_history
WHERE event_id = 506183215 -- İlgili Event ID
  AND sample_time BETWEEN TO_DATE('16-01-2026 10:00', 'DD-MM-YYYY HH24:MI') 
                      AND TO_DATE('16-01-2026 11:00', 'DD-MM-YYYY HH24:MI')
GROUP BY sql_id 
ORDER BY samples DESC;
```

<Callout type="info" title="İpucu">
Event ID'yi `V$EVENT_NAME` view'inden bulabilir veya doğrudan event ismini (`EVENT`) kullanabilirsiniz.
</Callout>

### 4. SQL Metinlerini AWR Geçmişinden Getirme

Eğer SQL_ID'yi bulduysanız ama metnini (kodunu) göremiyorsanız:

```sql
SELECT sql_text 
FROM dba_hist_sqltext 
WHERE sql_id = '4mktud2qu1vgq';
```

## ASH Kullanım Senaryoları

### Senaryo 1: Belirli Bir Uygulamanın Yükü
Uygulama sunucusundan gelen sorguların (`PROGRAM` bazlı) hangi saatlerde SQL Plan değişikliği yaptığını veya beklediğini ASH ile saptayabilirsiniz.

### Senaryo 2: "Sistem Dün Saat 14:00'te Durdu"
Böylesi bir şikayette ASH historik tablolarına giderek, o 1-2 dakikalık dilimde sistemi kilitleyen blocking session'ı veya aşırı I/O yapan SQL_ID'yi saniyeler içinde raporlayabilirsiniz.

### Senaryo 3: Parallel Execution Analizi
Parallel sorguların node'lar arasındaki dağılımını ve hangi slave process'lerin beklediğini ASH üzerinden takip etmek mümkündür.

<Callout type="warning" title="Önemli Lisans Uyarısı">
ASH ve AWR verilerini doğrudan sorgulamak için Oracle **Diagnostics Pack** lisansına sahip olmanız gerekmektedir. Standart Edition'da bu view'lar bulunmaz.
</Callout>

## Sonuç

ASH, Oracle DBA'ların elindeki en güçlü diagnostik araçtır. Saniyeler bazında veri sunduğu için anlık "spike"ları (ani yük artışlarını) yakalamanızı sağlar. ASH sorgulama becerilerinizi geliştirmek, performans tuning süreçlerinizi inanılmaz derecede hızlandıracaktır.
