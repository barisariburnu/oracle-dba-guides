---
title: "Oracle Oturum ve Kullanıcı Bazlı SQL Geçmiş Analizi"
description: "Oracle veritabanında belirli bir SID veya kullanıcı için çalıştırılan SQL sorgularını bulma, ASH üzerinden geçmişe dönük SQL aktivite raporlama rehberi."
date: "2026-01-16"
category: "Performans"
tags: ["Oracle SQL History", "ASH", "V$SESSION", "V$SQL", "Troubleshooting", "DBA"]
author: "Oracle DBA Blog"
---

# Oracle Oturum ve Kullanıcı Bazlı SQL Geçmiş Analizi

Veritabanı yönetiminde bazen "Şu an bu oturum ne çalıştırıyor?" veya "Dün saat 14:00'te bu kullanıcı hangi sorguları gönderdi?" gibi sorulara hızlı yanıt vermemiz gerekir. Oracle, anlık oturum bilgilerini `V$SESSION` üzerinden sunarken, geçmişe dönük verileri **Active Session History (ASH)** mekanizması ile saklar. Bu makalede, SID bazlı veya zaman aralığı bazlı SQL geçmişini nasıl sorgulayacağınızı inceleyeceğiz.


<!--truncate-->
## 1. Anlık Oturumun Çalıştırdığı SQL'i Bulma (SID Bazlı)

Eğer sistemde çalışan bir `SID` (Session ID) tespit ettiyseniz ve bu oturumun tam olarak hangi SQL kodunu çalıştırdığını görmek istiyorsanız şu sorguyu kullanabilirsiniz:

```sql
SELECT s.sid, 
       s.serial#, 
       s.username, 
       s.osuser, 
       s.machine, 
       q.sql_text,
       q.sql_fulltext
FROM v$session s
JOIN v$sql q ON s.sql_id = q.sql_id
WHERE s.sid = :target_sid; -- Örn: 145
```

---

## 2. Kullanıcı Bazlı Zaman Aralıklı SQL Geçmişi (ASH)

"Ahmet kullanıcısı dün saat 16:30 ile 16:50 arasında ne yaptı?" sorusunun cevabı `V$ACTIVE_SESSION_HISTORY` görünümündedir. ASH, her saniye aktif oturumların bir fotoğrafını çeker.

```sql
SELECT DISTINCT ash.sql_id, 
                ss.sql_text, 
                ash.machine, 
                ash.sample_time AS "Execution_Time"
FROM v$active_session_history ash
JOIN v$sql ss ON ss.sql_id = ash.sql_id
JOIN dba_users du ON du.user_id = ash.user_id
WHERE du.username = 'AHMET_USER'
  AND ash.sample_time BETWEEN TO_TIMESTAMP('2024-01-15 16:30:00', 'YYYY-MM-DD HH24:MI:SS')
                          AND TO_TIMESTAMP('2024-01-15 16:50:00', 'YYYY-MM-DD HH24:MI:SS')
ORDER BY ash.sample_time;
```

---

## 3. Tarih Aralığına Göre SQL Listesi (AWR)

Eğer aradığınız veri 1 saatten daha eskiyse (ASH'den silindiyse), AWR geçmişine (`DBA_HIST_...`) bakmanız gerekir:

```sql
SELECT DISTINCT h.sql_id, 
                t.sql_text, 
                h.sample_time
FROM dba_hist_active_sess_history h
JOIN dba_hist_sqltext t ON h.sql_id = t.sql_id
WHERE h.user_id = (SELECT user_id FROM dba_users WHERE username = 'REPORT_USER')
  AND h.sample_time BETWEEN TO_DATE('14.01.2024', 'DD.MM.YYYY') 
                        AND TO_DATE('15.01.2024', 'DD.MM.YYYY')
ORDER BY h.sample_time;
```

---

## Önemli İpuçları ve Notlar

*   **SID vs SQL_ID:** `V$SESSION` içindeki `SQL_ID` o an çalışan sorguyu gösterir. Eğer oturum o an bir şey çalıştırmıyorsa `SQL_ID` boş dönebilir, bu durumda `PREV_SQL_ID` kolonuna bakarak bir önceki sorguyu bulabilirsiniz.
*   **ASH Veri Süresi:** `V$ACTIVE_SESSION_HISTORY` verileri bellekte tutulur ve genellikle son 1-2 saatlik veriyi içerir. Daha eskiye gitmek için `DBA_HIST_ACTIVE_SESS_HISTORY` kullanın.
*   **Machine ve Program:** Sorgulara `ash.machine` veya `ash.program` katarak, sorgunun hangi uygulama sunucusundan veya hangi araçla (SQL Developer, Java Uygulaması vb.) çalıştırıldığını saptayabilirsiniz.

Bu yöntemlerle, veritabanı kullanıcılarının ayak izlerini takip edebilir, performans sorunlarını spesifik bir zaman dilimi ve kullanıcı ile saniyeler içinde ilişkilendirebilirsiniz.
